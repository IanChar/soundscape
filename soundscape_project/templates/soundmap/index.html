{% extends 'soundmap/base.html' %}

{% load static %}

{% load dajaxice_templatetags %}

{% block head_block %} 
	{% dajaxice_js_import %}
	<link rel="stylesheet" href="{% static 'jquery-ui/jquery-ui.theme.min.css' %}"/>
	<link rel="stylesheet" href="{% static 'css/index_style.css' %}" />
    <script src="http://connect.soundcloud.com/sdk.js"></script>
    <script src="{% static 'jquery-ui/jquery-ui.min.js' %}"></script>
    <script src="{% static 'geolocation_service.js' %}"></script>
    <script type="text/javascript">
    	function populate_map_helper(data) {
    		var key;
    		for(key in data) {
    			var song = data[key];
    			populate_map(song);
    		}
    	}
    	jQuery(document).ready(function ($) {
    		Dajaxice.soundmap.getMarkerInfo(populate_map_helper);
    		loadCoordinates();
    	});
    </script>
    <script src="{% static 'modal_form.js' %}"></script>
{% endblock %}


{% block body_block %}

    <div class = "col-md-9" id="mapContainer"></div>

    <div class = "col-md-3" id="songTable">
    	{% block side_block %}
    	{% if song_list %}
    		<ul id = "playlist">
    			{% for song in song_list %}
    			<li><a onclick = "playMusic('{{song.url}}')" id="{{song.artist}}">{{song.name}} -- {{song.artist}}</a></li>
    			{% endfor %}
    		</ul>
    	{% else %}
	    	<ul>
	    		<li> No songs to play at this time </li>
	    	</ul>
	    {% endif %}
	    <a href = "/soundmap/add_song/">Add a new song</a>
		{% endblock %}
		
	    <div id="soundcloudPlayer">
	    	<p>Click on a marker to hear a song!</p>
	    </div>
    </div>

    <div id="dialog-form" title="Add a Song">
    	<fieldset>
    	<span class="validateTips"> All form fields are required. </span>
            <form id="song_form" method="post" action="/soundmap/add_song/">
                {% csrf_token %}
                {% for hidden in form.hidden_fields %}
                    {{ hidden }}
                {% endfor %}

                {% for field in form.visible_fields %}
                    {{ field.errors }} </br>
                    <label> {{ field.help_text }} </label>
                    <input id="{{field.name}}" class="form-control text ui-widget-content" type="{{field.field.widget.input_type}}" name="{{field.name}}" value="" placeholder="{{field.label}}"/>
                {% endfor %}
                </br>
                <input type="submit" tabindex="-1" style="position:absolute; top:-1000px" />
            </form>
        </fieldset>
	</div>
	<button id="addsong">Place a marker</button>
	<script type="text/javascript" src="{% static "map.js" %}"></script>

{% endblock %}